### 2.2.5 基于图的向量索引方法

基于图的向量索引是目前向量数据库中使用最广泛，查询性能最高的索引类型之一。
然而，图索引的发展历史并不如其他经典向量索引类型那样长。
最早用于KNN查询的图索引是KNN图，它的一种高效近似构建算法在2011年被提出。
后续研究者将KNN图与小世界网络模型（small-world network）相结合，逐步开发出NSW，HNSW，NSG等索引，在深度神经网络输出的嵌入向量上获得显著的查询性能提升。
本章节以经典的KNN图和HNSW为例，介绍图向量索引的概念、原理和算法。

#### 2.2.5.1 概述
基于图的向量索引将数据集中的每个向量表示为图中的一个点，同时根据向量间的距离（或称为相似性）为图赋边。不同图索引结构主要指不同的赋边策略。现代图索引多为有向图，也有部分为无向图。



图索引的设计动机来自于小世界网络模型中的六度分隔理论。举一个通俗的例子，在人类社会的社交网络中（网络中的边为社交关系），从任何一个节点出发，在6步之内可以到达大部分网络中的节点。那么若以类似的方式将向量组织成网络（图），便可以从任意入口点出发，在较少步数内，到达查询点的最近邻。

![toy-example](../../images/chap2/toy_example.png)
<div align=center>
<p>图2.1 图索引的一个例子</p>
</div>

受小世界网络模型的启发，图索引也设计了贪婪的查询算法。如图2.1，给定一个查询点（query），图索引会选定一个入口点（entry point），然后从其邻居节点中选择最靠近查询点作为下一步。依次类推，当前点会逐步靠近查询点，并最终收敛，即，当前点比所有的邻居点更靠近查询点。



图索引的查询代价通常由距离计算次数度量。在贪婪查询算法中，查询代价由两部分构成：搜索路径长度，和平均邻居个数。在搜索的每一步上，需要计算邻居节点和查询节点之间的距离。这引出了图索引结构的一个重要设计权衡：稀疏性—导航性权衡。总的来说，图越稀疏，每一步的计算代价越低，算法效率越高；相反，图越稠密，从入口点到达最近邻点的期望路径长度越短，算法效率越高。因此，为实现最优的查询性能，图索引的设计需要在稀疏性和导航性之间寻取一个最优的平衡。



注意上述查询算法是在$k=1$时的简化版本，且无法通过参数控制精度和效率的权衡。我们将在下一节中介绍$k>1$的场景和集束搜索的扩展。尽管如此，上述分析同样适用于扩展搜索算法。另外，由于使用了贪婪的查询算法，图索引没有对查询的精度保障。



#### 2.2.5.2 KNN图

索引结构：顾名思义，KNN图中，每个节点指向其K个最近邻。注意，最近邻关系不是对称关系。也就是说，若节点A是节点B的最近邻，节点B不一定是节点A的最近邻。因此，KNN图是有向图。



由于精确寻找每个数据集中节点的K个最近邻的代价过高，KNN图一般以近似的方式构建。