## 4.2 向量数据库面临的挑战

截止目前，向量数据库在国内外仍处于发展的早期阶段，其稳定性、效率和应用场景正在实践中不断探索。

本节列举了目前向量数据库面临的主要挑战和未来发展趋势。



### 4.2.1 向量标量混合查询

向量标量混合查询在向量检索的基础上添加了标量过滤约束，即返回的相似向量还要满足给定的过滤条件。根据标量过滤与向量检索的执行顺序，当前的混合查询方法可分为三类：前期过滤、后期过滤、融合过滤。前期过滤是指先根据标量约束过滤出符合标量要求的候选，然后在此候选上执行向量检索获取向量距离较近的结果。后期过滤是指先执行向量检索召回向量距离较近的候选，然后对候选进行标量过滤获取满足标量约束的结果。融合过滤是指向量检索和属性过滤同时执行，直接获取既满足向量相似性又满足标量约束的结果。根据具体处理场景的差异，三种不同的过滤策略各有优势。当前，根据这三种过滤策略设计的方法虽能满足一些特定应用的需求，但都不同程度地存在局限性。向量标量混合查询仍面临以下几个挑战：

1. 如何确定最优候选数量？无论是前期过滤还是后期过滤，最终结果都是两步生成的，即先生成候选，而后在候选上获取结果。因此，确定最佳候选数至关重要，这直接决定着搜索的效率和结果的精度。比如，如果候选数过少，则可能导致获取的最终结果不足甚至得不到符合要求的结果，破坏了结果的精度；如果候选数过多，则可能导致大量的冗余计算，降低了搜索的效率。有效且高效地评估最佳候选数仍然是一个具有挑战性的问题。

2. 如何联合向量距离和标量距离？融合过滤方案通常需要综合评估向量相似性和标量的匹配度，而后为两者打一个总分，以此排序中间访问结果。然而，向量距离与标量距离之间往往不具有可比性，因此需要将两者映射到相同的度量空间中，并分配不同的权重。然而，不同的场景下的向量距离和标量距离可能具有显著不同的度量方式和权重分配方式，比如有时候向量距离更重要，而有时候权重距离更重要。因此，设计自适应的权重分配策略仍然具有挑战性。

3. 如何选择最优的执行策略？由于不同的混合查询策略在不同的查询负载下各有优势，一些向量数据库（比如Milvus、ADBV）实施多种混合查询策略，并基于代价模型对不同查询选择执行代价更低的策略。然而，这些方法假设可选择性等一些关键指标是已知的，这并不符合很多真实场景的特征。此外，为了估算搜索时间开销，它们的索引方法局限在暴力扫描、量化压缩等技术，难以扩展到当前最优的导航图索引上。因此，设计泛化性更强的最优执行策略选择方法仍具有挑战。

4. 如何处理复杂的标量过滤逻辑？当前的方法主要适用于处理标量过滤逻辑较简单的场景，比如“=”。然而，真实场景存在更多复杂的过滤逻辑，比如“>”、"<"、“>=”、"<="等，这给某些混合查询方法带来显著的挑战。例如，融合过滤策略难以处理不等式过滤逻辑。因此，设计一种鲁棒性更强的索引和检索策略以同时支持各种过滤逻辑的混合查询仍然需要进一步研究。



### 4.2.2 海量数据索引支持

@向隆？



### 4.2.3 动态数据集

经典的关系型数据库管理系统有四项基本操作：增、删、改、查。目前，向量数据库可以完成高效的查询（最近邻搜索），部分向量索引可以支持动态插入，对于数据的删除、修改，则大部分向量索引难以支持。然而，在实际应用场景中，对动态数据集的支持是一个基本需求。例如，在一个服务于电商平台的推荐系统中，一个商品的上架和下架就会涉及这个商品对应向量在数据库中的插入和删除；商品描述和详情的修改又会涉及向量的修改。



在向量数据库中高效处理动态数据集至少包含以下几个技术挑战：

1. 向量索引的更新。大部分向量索引需要根据数据集中的数据分布决定索引结构，而处理动态数据集要求索引能够自适应地根据数据分布的变化调整索引的结构。比如，随着新数据的插入，树索引需要细化分区，增加或重新选择空间分割方式（平面）；而数据的删除意味着需要分区的合并或分割方式的重新选择。对于图索引来说，插入和删除都意味着图中拓扑结构的调整，既要保证新增加的连接（边）不会影响图的稀疏性以保证查询效率，又要保证删除旧有的边不会让图索引的导航性受到影响。此外，由于图数据访问方式的复杂性，图索引的更新比其它索引更加困难。
2. 向量数据存储的更新。相比于标量数据，向量数据单条数据占据空间更大。因此，频繁的删除会使得存储空间更大的碎片化。此外，为了提高向量数据的访问效率，向量数据往往会分区存储以利用数据局部性（尤其是对于磁盘数据），同一分区的数据共同访问的概率更高。数据的更新可能破坏原有分区的平衡性，导致查询效率的降低。
3. 读写操作的并发控制。对向量索引的数据更新往往会引起索引结构以及其它数据存放位置的变化，相比于标量索引（如B+树），数据更新时，需要锁的范围会更大。因此，如何高效处理对于向量索引的读写并发控制也是一个亟需克服的挑战。



### 4.2.4 多模态检索

@梦召？



### 4.2.5 索引构建自动化

如本书所归纳，向量索引的发展已经有很长的历史，期间诞生了几十上百种向量索引。时至今日，仍有多种索引在不同的评估指标、不同数据集上占据着优势地位。比如，图索引中的HNSW在查询性能上是表现最佳的索引之一，而LSH索引在处理超高维向量时有明显优势，树索引中的Dumpy在时间序列上有着更好的可伸缩性。

对于用户而言，如何针对特定的数据集选择最合适的索引是非常困难的，而且在选择索引后，如何针对不同索引的特性选择构建参数，以及在运维过程中如何监测索引性能以进行调优则更加依赖对特定索引的研究知识。

由于以上问题的存在，用户往往会选择一个“基本可靠”的索引（即性能优良，广泛使用，社区活跃，文档丰富）来使用。比如，目前大部分的向量数据库仅支持两种索引，树索引中的IVF-Flat和图索引中的HNSW。尽管这两种索引在大部分时候可以基本满足用户需求；然而，缺少对特定数据分布和应用场景的分析，可能会让用户承担更高的成本和不可靠的服务。换句话说，索引类型和索引构建参数的不合理选择会使得用户的硬件资源不能发挥出应有的价值。



### 4.2.6 数据隐私与安全

@剑楠？ 



### 4.2.7 基于硬件的加速

@田冰？  http://sites.computer.org/debull/A23sept/p22.pdf  P12 Research Challenge 1





### 4.2.8 索引的理论保障与可靠性

向量索引的一个额外问题是性能的方差较大。即，对于不同的查询，得到指定精度的需要的查询时间（或给定查询时间的查询精度）差异是很大的，这一点对于图索引来说尤其明显。

在真实场景当中，用户往往需要处理不同难度的查询，这样的结果是会带来不可靠的服务质量。相比较而言，树索引有较为完备的理论保障和精确查询算法；LSH索引可以提供基于概率的精度保障；而基于图的索引和基于量化的索引对应的理论保障则与真实场景仍有较大偏差，这实际上增加了使用上的不可靠性。

因此，从理论意义上讲，如何为图和量化索引建立理论模型，进一步提供理论保障仍然是一个需要解决的问题；从实践意义讲，如何设计一个性能方差较小且高效的向量索引，也是提升向量索引服务质量必须要解决的问题。



### 4.2.9 请补充





